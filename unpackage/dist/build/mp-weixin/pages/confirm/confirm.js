"use strict";const e=require("../../common/vendor.js"),t=e.index.getMenuButtonBoundingClientRect(),o={components:{},data:()=>({menuButtonInfo:t,headersty:"padding-top:51px;height:32px;",mainsty:"height:calc(100vh - 83px - 200rpx);",headerLH:"line-height: 32px;",cart:[],store:"",customer:"",phone:"",note:""}),onLoad(){this.headersty="padding-top:"+t.top+"px;height:"+t.height+"px;",this.headerLH="line-height:"+t.height+"px;";const e=parseInt(t.height)+parseInt(t.top);this.mainsty="height:calc(100vh - "+e+"px - 200rpx);"},onShow(){this.cart=this.getCart(),this.store=this.getStore(),this.customer=this.getCustomer(),this.getQueue().then((e=>{this.store.queue=e})).catch((e=>{console.log(e)}))},methods:{getCart:()=>e.index.getStorageSync("cart"),getCustomer:()=>e.index.getStorageSync("customer"),back(){e.index.navigateBack()},pay(){if(null==this.phone||""==this.phone)e.index.showModal({title:"提示",content:"请输入联系方式",showCancel:!1,confirmColor:"#B8701B",success:function(e){}});else{let n=[];for(var t=0;t<this.cart.list.length;t++){let e=this.cart.list[t],i=[];for(var o=0;o<e.custom.length;o++){let t=e.custom[o];const n={item:t.title,value:t.option[t.opt].text};i.push(n)}let s={id:e.id,name:e.name,price:e.finalPrice,img:e.img,num:e.num,custom:i};n.push(s)}let i={sid:this.store.id,cid:this.customer.id,num:this.cart.totalNum,price:this.cart.totalPrice,commodity:n,phone:this.phone,note:this.note};const s=e.index.getStorageSync("token");e.index.showModal({title:"提示",content:"点击“确定”模拟支付完成",confirmColor:"#B8701B",success:t=>{t.confirm?(e.index.showLoading({title:"提交中"}),e.index.request({url:getApp().globalData.host+"/v1/customer/order/add",method:"POST",data:{data:i},header:{"content-type":"application/json",Authorization:s},success:t=>{e.index.hideLoading(),e.index.navigateTo({url:"/pages/payres/payres",animationType:"none"})},fail:e=>{console.log(e)}})):t.cancel&&console.log("用户点击取消")}})}},delCart(){e.index.removeStorageSync("cart")},getQueue(){const t=e.index.getStorageSync("token");return new Promise(((o,n)=>{e.index.request({url:getApp().globalData.host+"/v1/customer/storequeue?id="+this.store.id,method:"GET",header:{Authorization:t},success:e=>{o(e.data.data.queue)},fail:e=>{n(e)}})}))},getStore:()=>e.index.getStorageSync("store")}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("t-image")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-section"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js"))();const n=e._export_sfc(o,[["render",function(t,o,n,i,s,a){return{a:e.o((e=>a.back())),b:e.p({type:"back",size:"20"}),c:e.s(s.headerLH),d:e.s(s.headersty),e:e.t(s.store.name),f:e.t(s.store.queue),g:e.f(s.cart.list,((t,o,n)=>({a:"5f1e7aa5-1-"+n,b:e.p({src:t.img,mode:"widthFix"}),c:e.t(t.name),d:e.f(t.custom,((t,o,n)=>({a:e.t(t.option[t.opt].text)}))),e:e.t(t.finalPrice),f:e.t(t.num)}))),h:e.t(s.cart.totalPrice),i:e.t(s.cart.totalNum),j:e.o((e=>s.phone=e)),k:e.p({placeholder:"",modelValue:s.phone}),l:e.p({title:"联系方式",subTitle:"",type:"line",padding:!0}),m:e.o((e=>s.note=e)),n:e.p({type:"textarea",autoHeight:!0,placeholder:"",modelValue:s.note}),o:e.p({title:"订单备注",subTitle:"",type:"line",padding:!0}),p:e.s(s.mainsty),q:e.o((e=>a.pay()))}}],["__scopeId","data-v-5f1e7aa5"]]);wx.createPage(n);
