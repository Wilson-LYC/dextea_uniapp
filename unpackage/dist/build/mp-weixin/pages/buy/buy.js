"use strict";const t=require("../../common/vendor.js"),e=t.index.getMenuButtonBoundingClientRect(),o={components:{BottomNav:()=>"../../components/BottomNav.js"},data:()=>({menuButtonInfo:e,headersty:"padding-top:51px;height:32px;",mainsty:"height:calc(100vh - 83px - 170rpx);",headerLH:"line-height: 32px;",store:{},menu:[],classIndex:0,commScrollId:"class0",cDetail:{},cart:{list:[],totalPrice:0,totalNum:0}}),onLoad(){this.headersty="padding-top:"+e.top+"px;height:"+e.height+"px;",this.headerLH="line-height:"+e.height+"px;";const t=parseInt(e.height)+parseInt(e.top);this.mainsty="height:calc(100vh - "+t+"px - 170rpx);"},onShow(){if(this.cart=this.getCart(),this.getCity()){let t=this.getStoreId();t?(this.getStoreInfoBySid(t).then((t=>{this.store=t})).catch((t=>{console.log(t)})),this.getMenuBySid(t).then((t=>{this.menu=t})).catch((t=>{console.log(t)}))):this.navToStoreList()}else this.navToAreaList()},onHide(){this.saveCart(this.cart),this.store&&this.savaSoteInfo(this.store)},methods:{changMenuClass(t){this.classIndex=t,this.commScrollId="class"+t},openCommDetail(t){this.cDetail=JSON.parse(JSON.stringify(t)),this.cDetail.num=1,this.cDetail.finalPrice=this.cDetail.price,this.$refs.commDetail.open("bottom")},closeCommDetail(){this.$refs.commDetail.close()},changeCustom(t,e){t.opt=e,this.cDetail.finalPrice=parseFloat(this.cDetail.price);for(var o=0;o<this.cDetail.custom.length;o++){var a=this.cDetail.custom[o].opt;this.cDetail.finalPrice+=parseFloat(this.cDetail.custom[o].option[a].cost)}},addToCart(){for(var t=!1,e=0;e<this.cart.list.length;e++){var o=this.cart.list[e];o.id===this.cDetail.id&&JSON.stringify(o.custom)===JSON.stringify(this.cDetail.custom)&&(o.num+=this.cDetail.num,t=!0)}if(!t){const t=JSON.parse(JSON.stringify(this.cDetail));this.cart.list.push(t)}this.$refs.commDetail.close(),this.updataCartInfo()},buyNow(){this.cart.list=[];let t=JSON.parse(JSON.stringify(this.cDetail));this.cart.list.push(t),this.updataCartInfo(),this.comfireOrder()},updataCartInfo(){for(var t=this.cart.list,e=0;e<t.length;e++){(i=parseFloat(t[e].num))<1&&this.delCommInCart(e)}t=this.cart.list;var o=0,a=0;for(e=0;e<t.length;e++){var i;o+=parseFloat(t[e].finalPrice)*(i=parseFloat(t[e].num)),a+=i}this.cart.totalNum=a,this.cart.totalPrice=o},comfireOrder(){let e=this.getStoreId();this.getStoreInfoBySid(e).then((t=>{this.store=t})).catch((t=>{console.log(t)})),"1"==this.store.openState?t.index.navigateTo({url:"/pages/confirm/confirm"}):t.index.showToast({title:"门店已休息~",icon:"none",duration:2e3})},openCartDetail(){this.updataCartInfo(),this.$refs.cartDetail.open("bottom")},closeCartDetail(){this.updataCartInfo(),this.$refs.cartDetail.close()},delCommInCart(t){this.cart.list.splice(t,1)},saveCart(e){t.index.setStorageSync("cart",e)},getCart(){const e=t.index.getStorageSync("cart");if(e)return e;return{list:[],totalPrice:0,totalNum:0}},getMenuBySid(e){const o=t.index.getStorageSync("token");return new Promise(((a,i)=>{t.index.request({url:getApp().globalData.host+"/v1/customer/menu?id="+e,method:"GET",header:{Authorization:o},success:t=>{a(t.data.data.menu)},fail:t=>{i(t)}})}))},getCity:()=>t.index.getStorageSync("city"),getStoreId:()=>t.index.getStorageSync("sid"),getStoreInfoBySid(e){const o=t.index.getStorageSync("token");return new Promise(((a,i)=>{t.index.request({url:getApp().globalData.host+"/v1/customer/store/detail?id="+e,header:{Authorization:o},success:t=>{a(t.data.data.store)},fail:t=>{i(t)}})}))},navToStoreList(){t.index.navigateTo({url:"/pages/storeList/storeList"})},navToAreaList(){t.index.navigateTo({url:"/pages/openArea/openArea"})},savaSoteInfo(e){t.index.setStorageSync("store",e)}}};if(!Array){(t.resolveComponent("uni-icons")+t.resolveComponent("t-image")+t.resolveComponent("BottomNav")+t.resolveComponent("uni-number-box")+t.resolveComponent("uni-popup")+t.resolveComponent("uni-badge")+t.resolveComponent("t-col")+t.resolveComponent("t-row"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-number-box/components/uni-number-box/uni-number-box.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-badge/components/uni-badge/uni-badge.js"))();const a=t._export_sfc(o,[["render",function(e,o,a,i,s,n){return t.e({a:t.s(s.headerLH),b:t.s(s.headersty),c:t.t(s.store.name),d:t.p({type:"right",size:"15"}),e:t.o((t=>n.navToStoreList())),f:t.p({type:"location",size:"13",color:"#999999"}),g:t.f(s.menu,((e,o,a)=>({a:t.t(e.class),b:t.o((t=>n.changMenuClass(o))),c:t.n(s.classIndex==o?"class-item-sel":"class-item")}))),h:t.f(s.menu,((e,o,a)=>({a:t.t(e.class),b:"class"+o,c:t.f(e.commodity,((e,o,i)=>t.e({a:"1fafdcfb-2-"+a+"-"+i,b:t.p({src:e.img,mode:"widthFix"}),c:t.t(e.name),d:t.t(e.briefInfo),e:t.t(e.price),f:"1"==e.state},(e.state,{}),{g:t.o((t=>n.openCommDetail(e)))})))}))),i:s.commScrollId,j:t.s(s.mainsty),k:t.p({vid:"2"}),l:t.o(n.closeCommDetail),m:t.p({type:"closeempty",size:"20"}),n:t.p({src:s.cDetail.img,mode:"heightFix"}),o:t.t(s.cDetail.name),p:t.t(s.cDetail.info),q:t.f(s.cDetail.custom,((e,o,a)=>({a:t.t(e.title),b:t.f(e.option,((o,a,i)=>({a:t.t(o.text),b:t.n(a==e.opt?"cdc-item-sel":"cdc-item"),c:t.o((t=>n.changeCustom(e,a)))})))}))),r:t.t(s.cDetail.finalPrice),s:t.o((t=>s.cDetail.num=t)),t:t.p({min:1,modelValue:s.cDetail.num}),v:"1"==s.cDetail.state},"1"==s.cDetail.state?{w:t.o((t=>n.buyNow())),x:t.o((t=>n.addToCart()))}:{},{y:t.sr("commDetail","1fafdcfb-4"),z:t.p({type:"bottom","safe-area":!1}),A:"1"==s.store.openState},"1"==s.store.openState?t.e({B:s.cart.totalNum>0},s.cart.totalNum>0?{C:t.p({"custom-prefix":"iconfont",type:"icon-bag",size:"30",color:"#ffffff"}),D:t.p({size:"small",text:s.cart.totalNum,absolute:"rightTop",type:"error"}),E:t.t(s.cart.totalPrice),F:t.o((t=>n.openCartDetail())),G:t.o((t=>n.comfireOrder()))}:{}):{},{H:"2"==s.store.openState},(s.store.openState,{}),{I:t.p({span:"22"}),J:t.o((t=>n.closeCartDetail())),K:t.p({type:"closeempty",size:"20"}),L:t.p({span:"2"}),M:t.t(s.store.name),N:t.f(s.cart.list,((e,o,a)=>t.e({a:e.num>0},e.num>0?{b:"1fafdcfb-17-"+a+",1fafdcfb-16-"+a,c:t.p({src:e.img,mode:"widthFix"}),d:"1fafdcfb-16-"+a+",1fafdcfb-15-"+a,e:t.p({span:"8"}),f:t.t(e.name),g:t.f(e.custom,((e,o,a)=>({a:t.t(e.option[e.opt].text)}))),h:t.t(e.finalPrice),i:"1fafdcfb-20-"+a+",1fafdcfb-19-"+a,j:t.p({span:"8"}),k:"1fafdcfb-22-"+a+",1fafdcfb-21-"+a,l:t.o((t=>e.num=t)),m:t.p({modelValue:e.num}),n:"1fafdcfb-21-"+a+",1fafdcfb-19-"+a,o:t.p({span:"10",offset:"4"}),p:"1fafdcfb-19-"+a+",1fafdcfb-18-"+a,q:"1fafdcfb-18-"+a+",1fafdcfb-15-"+a,r:t.p({span:"16"}),s:"1fafdcfb-15-"+a+",1fafdcfb-10",t:t.p({gutter:10})}:{}))),O:s.cart.list.length>0},s.cart.list.length>0?{P:t.o((t=>n.comfireOrder()))}:{},{Q:s.cart.list.length<1},(s.cart.list.length,{}),{R:t.sr("cartDetail","1fafdcfb-10"),S:t.p({type:"bottom","safe-area":!1})})}],["__scopeId","data-v-1fafdcfb"]]);wx.createPage(a);
